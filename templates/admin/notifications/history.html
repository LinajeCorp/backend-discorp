{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}{{ title }} | {{ site_title|default:"Django site admin" }}{% endblock %}

{% block branding %}
<h1 id="site-name">
    <a href="{% url 'admin:index' %}">üìä {{ site_header|default:"Django administration" }}</a>
</h1>
{% endblock %}

{% block content_title %}
<h1>üìà {{ title }}</h1>
{% endblock %}

{% block content %}
<div class="module aligned">
    <!-- Botones de navegaci√≥n -->
    <div style="margin-bottom: 20px;">
        <a href="{% url 'admin:send_notification' %}" class="btn-primary">
            üöÄ Enviar Nueva Notificaci√≥n
        </a>
        <a href="{% url 'admin:notifications_notificationhistory_changelist' %}" class="btn-success">
            üìã Volver al Historial
        </a>
    </div>

    <!-- Tabla de historial detallado -->
    {% if notifications %}
    <div class="results">
        <table id="result_list">
            <thead>
                <tr>
                    <th scope="col">
                        <div class="text">T√≠tulo</div>
                    </th>
                    <th scope="col">
                        <div class="text">Tipo</div>
                    </th>
                    <th scope="col">
                        <div class="text">Destinatario</div>
                    </th>
                    <th scope="col">
                        <div class="text">Enviado por</div>
                    </th>
                    <th scope="col">
                        <div class="text">Estado</div>
                    </th>
                    <th scope="col">
                        <div class="text">Dispositivos</div>
                    </th>
                    <th scope="col">
                        <div class="text">Fecha</div>
                    </th>
                    <th scope="col">
                        <div class="text">Mensaje</div>
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for notification in notifications %}
                <tr class="{% cycle 'row1' 'row2' %}">
                    <td>
                        <strong>{{ notification.title }}</strong>
                    </td>
                    <td>
                        {{ notification.type_badge|safe }}
                    </td>
                    <td>
                        {% if notification.target_user %}
                            üë§ {{ notification.target_user.username }}
                        {% elif notification.notification_type == 'broadcast' %}
                            üì¢ Todos los usuarios
                        {% else %}
                            ‚ùì No especificado
                        {% endif %}
                    </td>
                    <td>
                        üë®‚Äçüíº {{ notification.sent_by.username }}
                    </td>
                    <td>
                        {{ notification.status_badge|safe }}
                    </td>
                    <td>
                        <span style="font-weight: bold; color: #007bff;">
                            {{ notification.devices_count }}
                        </span>
                    </td>
                    <td>
                        {{ notification.created_at|date:"d/m/Y H:i" }}
                    </td>
                    <td style="max-width: 300px; word-wrap: break-word;">
                        {{ notification.body|truncatewords:10 }}
                        {% if notification.error_message %}
                            <br><small class="error-text">
                                <strong>Error:</strong> {{ notification.error_message|truncatewords:5 }}
                            </small>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="module empty-state">
        <h3>üì≠ No hay notificaciones en el historial</h3>
        <p>Comienza enviando tu primera notificaci√≥n</p>
        <a href="{% url 'admin:send_notification' %}" class="btn-primary" style="font-size: 16px; padding: 15px 30px;">
            üöÄ Enviar Primera Notificaci√≥n
        </a>
    </div>
    {% endif %}

    <!-- Informaci√≥n adicional -->
    <div class="info-module">
        <h3 style="margin-top: 0;">‚ÑπÔ∏è Informaci√≥n</h3>
        <ul style="margin-bottom: 0;">
            <li><strong>Estados:</strong> 
                <span class="status-sent">‚úÖ Enviado</span>, 
                <span class="status-pending">‚è≥ Pendiente</span>, 
                <span class="status-failed">‚ùå Fallido</span>
            </li>
            <li><strong>Tipos:</strong> 
                üß™ Prueba, üë§ Usuario espec√≠fico, üì¢ Broadcast, üë®‚Äçüíº Administrador
            </li>
            <li><strong>Dispositivos:</strong> N√∫mero de dispositivos que recibieron la notificaci√≥n</li>
        </ul>
    </div>
</div>

<style>
/* Estilos que respetan el tema dark/light del admin de Django */
#result_list {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    background: var(--body-bg, #fff);
    color: var(--body-fg, #333);
}

#result_list th, #result_list td {
    padding: 8px 12px;
    text-align: left;
    border-bottom: 1px solid var(--hairline-color, #ddd);
    vertical-align: top;
}

#result_list th {
    background-color: var(--darkened-bg, #f8f9fa);
    font-weight: bold;
    color: var(--body-fg, #495057);
    border-bottom: 1px solid var(--hairline-color, #ddd);
}

#result_list .row1 {
    background-color: var(--darkened-bg, #f9f9f9);
}

#result_list .row2 {
    background-color: var(--body-bg, #ffffff);
}

#result_list tr:hover {
    background-color: var(--selected-bg, #e9ecef);
}

.module {
    background: var(--body-bg, #fff);
    color: var(--body-fg, #333);
    border: 1px solid var(--hairline-color, #ddd);
}

.module h3 {
    margin-bottom: 15px;
    color: var(--body-fg, #333);
}

/* Botones que respetan el tema */
.button, .btn-primary {
    background: var(--primary, #007bff) !important;
    color: var(--primary-fg, #fff) !important;
    border: 1px solid var(--primary, #007bff) !important;
    padding: 10px 20px;
    text-decoration: none;
    border-radius: 5px;
    margin-right: 10px;
    display: inline-block;
}

.btn-success {
    background: var(--success-fg, #28a745) !important;
    color: #fff !important;
    border: 1px solid var(--success-fg, #28a745) !important;
}

.button:hover, .btn-primary:hover, .btn-success:hover {
    opacity: 0.8;
    color: #fff !important;
}

/* Informaci√≥n adicional con tema */
.info-module {
    background: var(--darkened-bg, #f8f9fa);
    color: var(--body-fg, #495057);
    border: 1px solid var(--hairline-color, #dee2e6);
    padding: 15px;
    border-radius: 8px;
    margin-top: 30px;
}

/* Estados con colores que funcionan en dark/light */
.status-sent {
    color: var(--success-fg, #28a745);
    font-weight: bold;
}

.status-pending {
    color: var(--warning-fg, #ffc107);
    font-weight: bold;
}

.status-failed {
    color: var(--error-fg, #dc3545);
    font-weight: bold;
}

/* Texto de error */
.error-text {
    color: var(--error-fg, #dc3545);
}

/* Empty state */
.empty-state {
    text-align: center;
    padding: 40px;
    color: var(--body-quiet-color, #666);
}

.empty-state h3 {
    color: var(--body-quiet-color, #666);
}

.empty-state p {
    color: var(--body-quiet-color, #999);
    margin-bottom: 20px;
}

/* Responsive para m√≥vil */
@media (max-width: 768px) {
    #result_list th, #result_list td {
        padding: 6px 8px;
        font-size: 12px;
    }
    
    .button, .btn-primary, .btn-success {
        padding: 8px 15px;
        font-size: 14px;
        margin-bottom: 10px;
        display: block;
        text-align: center;
    }
}
</style>
{% endblock %}
