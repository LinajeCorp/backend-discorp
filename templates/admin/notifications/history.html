{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}{{ title }} | {{ site_title|default:"Django site admin" }}{% endblock %}

{% block branding %}
<h1 id="site-name">
    <a href="{% url 'admin:index' %}">üìä {{ site_header|default:"Django administration" }}</a>
</h1>
{% endblock %}

{% block content_title %}
<h1>üìà {{ title }}</h1>
{% endblock %}

{% block content %}
<div class="module aligned">
    <!-- Botones de navegaci√≥n -->
    <div style="margin-bottom: 20px;">
        <a href="{% url 'admin:send_notification' %}" 
           style="display: inline-block; padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 5px; margin-right: 10px;">
            üöÄ Enviar Nueva Notificaci√≥n
        </a>
        <a href="{% url 'admin:notifications_notificationhistory_changelist' %}" 
           style="display: inline-block; padding: 10px 20px; background: #28a745; color: white; text-decoration: none; border-radius: 5px;">
            üìã Volver al Historial
        </a>
    </div>

    <!-- Tabla de historial detallado -->
    {% if notifications %}
    <div class="results">
        <table id="result_list">
            <thead>
                <tr>
                    <th scope="col">
                        <div class="text">T√≠tulo</div>
                    </th>
                    <th scope="col">
                        <div class="text">Tipo</div>
                    </th>
                    <th scope="col">
                        <div class="text">Destinatario</div>
                    </th>
                    <th scope="col">
                        <div class="text">Enviado por</div>
                    </th>
                    <th scope="col">
                        <div class="text">Estado</div>
                    </th>
                    <th scope="col">
                        <div class="text">Dispositivos</div>
                    </th>
                    <th scope="col">
                        <div class="text">Fecha</div>
                    </th>
                    <th scope="col">
                        <div class="text">Mensaje</div>
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for notification in notifications %}
                <tr class="{% cycle 'row1' 'row2' %}">
                    <td>
                        <strong>{{ notification.title }}</strong>
                    </td>
                    <td>
                        {{ notification.type_badge|safe }}
                    </td>
                    <td>
                        {% if notification.target_user %}
                            üë§ {{ notification.target_user.username }}
                        {% elif notification.notification_type == 'broadcast' %}
                            üì¢ Todos los usuarios
                        {% else %}
                            ‚ùì No especificado
                        {% endif %}
                    </td>
                    <td>
                        üë®‚Äçüíº {{ notification.sent_by.username }}
                    </td>
                    <td>
                        {{ notification.status_badge|safe }}
                    </td>
                    <td>
                        <span style="font-weight: bold; color: #007bff;">
                            {{ notification.devices_count }}
                        </span>
                    </td>
                    <td>
                        {{ notification.created_at|date:"d/m/Y H:i" }}
                    </td>
                    <td style="max-width: 300px; word-wrap: break-word;">
                        {{ notification.body|truncatewords:10 }}
                        {% if notification.error_message %}
                            <br><small style="color: #dc3545;">
                                <strong>Error:</strong> {{ notification.error_message|truncatewords:5 }}
                            </small>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="module" style="text-align: center; padding: 40px;">
        <h3 style="color: #666;">üì≠ No hay notificaciones en el historial</h3>
        <p style="color: #999; margin-bottom: 20px;">
            Comienza enviando tu primera notificaci√≥n
        </p>
        <a href="{% url 'admin:send_notification' %}" 
           style="display: inline-block; padding: 15px 30px; background: #007bff; color: white; text-decoration: none; border-radius: 8px; font-size: 16px;">
            üöÄ Enviar Primera Notificaci√≥n
        </a>
    </div>
    {% endif %}

    <!-- Informaci√≥n adicional -->
    <div class="module" style="margin-top: 30px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
        <h3 style="margin-top: 0; color: #495057;">‚ÑπÔ∏è Informaci√≥n</h3>
        <ul style="margin-bottom: 0;">
            <li><strong>Estados:</strong> 
                <span style="color: #28a745;">‚úÖ Enviado</span>, 
                <span style="color: #ffc107;">‚è≥ Pendiente</span>, 
                <span style="color: #dc3545;">‚ùå Fallido</span>
            </li>
            <li><strong>Tipos:</strong> 
                üß™ Prueba, üë§ Usuario espec√≠fico, üì¢ Broadcast, üë®‚Äçüíº Administrador
            </li>
            <li><strong>Dispositivos:</strong> N√∫mero de dispositivos que recibieron la notificaci√≥n</li>
        </ul>
    </div>
</div>

<style>
#result_list {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}

#result_list th, #result_list td {
    padding: 8px 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
    vertical-align: top;
}

#result_list th {
    background-color: #f8f9fa;
    font-weight: bold;
    color: #495057;
}

#result_list .row1 {
    background-color: #f9f9f9;
}

#result_list .row2 {
    background-color: #ffffff;
}

#result_list tr:hover {
    background-color: #e9ecef;
}

.module h3 {
    margin-bottom: 15px;
}
</style>
{% endblock %}
